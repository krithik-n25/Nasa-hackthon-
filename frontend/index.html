<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç Farm Navigator Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10/dist/framer-motion.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'deep-green': '#0f2027',
                        'forest': '#1a3a2e',
                        'emerald': '#10b981',
                        'mint': '#6ee7b7',
                        'sage': '#34d399'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        * {
            scroll-behavior: smooth;
        }
        
        .display-font {
            font-family: 'Outfit', 'Inter', system-ui, sans-serif;
        }
        
        .orbitron {
            font-family: 'Orbitron', 'Inter', system-ui, sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #000000 0%, #010101 50%, #000000 100%);
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(16, 185, 129, 0.25);
        }
        
        .animate-count {
            animation: countUp 2s ease-out;
        }
        
        @keyframes countUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.6); }
        }
        
        .chart-container {
            position: relative;
            height: 200px;
            width: 100%;
        }
        
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s;
        }
        
        .tooltip.show {
            visibility: visible;
            opacity: 1;
        }
        
        /* Ensure dropdown options are readable on light native menus */
        #locationSelect { color: #ffffff; }
        #locationSelect option { color: #111827; background-color: #ffffff; }
        #locationSelect optgroup { color: #9CA3AF; background-color: #ffffff; }
        /* Some browsers respect the select background; keep it transparent in header */
        #locationSelect:focus { outline: none; }
        
        /* Horizontal scroll video gallery */
        .hscroll-outer { height: 140vh; }
        .hscroll-sticky { position: sticky; top: 80px; height: 80vh; overflow: hidden; }
        .hscroll-track { display: flex; gap: 24px; height: 100%; will-change: transform; padding: 0 24px; }
        .hvideo { min-width: 60vw; height: 100%; background: linear-gradient(135deg, rgba(16,185,129,0.08), rgba(110,231,183,0.05)); border: 1px solid rgba(16,185,129,0.25); border-radius: 20px; overflow: hidden; position: relative; box-shadow: 0 25px 50px -12px rgba(16,185,129,0.25); }
        .hvideo-el { width: 100%; height: 100%; object-fit: cover; filter: saturate(1.05) contrast(1.05); transition: transform 0.5s ease, filter 0.5s ease; }
        .hvideo:hover .hvideo-el, .hvideo:focus-within .hvideo-el { transform: scale(1.04); filter: saturate(1.15) contrast(1.1); }
        .hvideo figcaption { position: absolute; left: 16px; bottom: 14px; font-family: 'Orbitron', 'Inter', sans-serif; font-weight: 800; letter-spacing: .5px; color: #fff; text-shadow: 0 6px 18px rgba(0,0,0,.45); background: rgba(0,0,0,.35); padding: 6px 10px; border-radius: 9999px; border: 1px solid rgba(255,255,255,.15); }
        
        /* Sleek Dark Fact Carousel Styles */
        .fact-carousel-container {
            position: relative;
            height: 240px;
            overflow: hidden;
            background: linear-gradient(135deg, 
                rgba(0, 0, 0, 0.8) 0%, 
                rgba(20, 20, 20, 0.9) 50%, 
                rgba(0, 0, 0, 0.8) 100%);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-clip: padding-box;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
        }
        
        .fact-carousel-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                rgba(255, 255, 255, 0.03) 0%, 
                transparent 50%, 
                rgba(255, 255, 255, 0.02) 100%);
            border-radius: 16px;
            z-index: 1;
            pointer-events: none;
        }
        
        .fact-carousel {
            position: relative;
            height: 100%;
            overflow: hidden;
            z-index: 2;
        }
        
        .fact-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            opacity: 0;
            transform: translateX(100%) scale(0.95);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 32px 24px;
            z-index: 1;
        }
        
        .fact-slide.active {
            opacity: 1;
            transform: translateX(0) scale(1);
            animation: slideInElegant 0.8s ease-out;
        }
        
        .fact-slide.prev {
            transform: translateX(-100%) scale(0.95);
        }
        
        @keyframes slideInElegant {
            0% { 
                opacity: 0;
                transform: translateX(30px) scale(0.95);
                filter: blur(2px);
            }
            100% { 
                opacity: 1;
                transform: translateX(0) scale(1);
                filter: blur(0px);
            }
        }
        
        .fact-icon {
            font-size: 3.5rem;
            margin-bottom: 24px;
            animation: iconFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
            position: relative;
            z-index: 2;
        }
        
        .fact-icon::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, 
                rgba(255, 255, 255, 0.1) 0%, 
                rgba(255, 255, 255, 0.05) 50%, 
                transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: iconGlow 4s ease-in-out infinite;
            z-index: -1;
        }
        
        @keyframes iconFloat {
            0%, 100% { 
                transform: translateY(0px) scale(1);
                filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
            }
            50% { 
                transform: translateY(-8px) scale(1.05);
                filter: drop-shadow(0 6px 16px rgba(0, 0, 0, 0.4));
            }
        }
        
        @keyframes iconGlow {
            0%, 100% { 
                opacity: 0.3;
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                opacity: 0.6;
                transform: translate(-50%, -50%) scale(1.1);
            }
        }
        
        .fact-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #e5e7eb;
            max-width: 100%;
            font-weight: 400;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
            position: relative;
            z-index: 2;
        }
        
        .carousel-indicators {
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.6);
            padding: 12px 20px;
            border-radius: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .indicator.active {
            background: #ffffff;
            transform: scale(1.4);
            box-shadow: 0 0 12px rgba(255, 255, 255, 0.4);
        }
        
        .indicator:hover {
            background: rgba(255, 255, 255, 0.6);
            transform: scale(1.2);
        }
        
        /* Subtle dark particles */
        .fact-carousel-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(1px 1px at 20px 30px, rgba(255, 255, 255, 0.1), transparent),
                radial-gradient(1px 1px at 40px 70px, rgba(255, 255, 255, 0.05), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(255, 255, 255, 0.08), transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255, 255, 255, 0.06), transparent);
            background-repeat: repeat;
            background-size: 200px 120px;
            animation: particleFloat 25s linear infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        @keyframes particleFloat {
            0% { transform: translateY(0px) translateX(0px); }
            100% { transform: translateY(-120px) translateX(30px); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white font-sans">
    <!-- Header Bar -->
    <header id="mainHeader" class="bg-black/20 backdrop-blur-lg border-b border-emerald/20 sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
				<div class="flex items-center space-x-4">
					<h1 class="orbitron whitespace-nowrap text-3xl md:text-4xl font-extrabold floating text-white tracking-wide drop-shadow">
						Farm Navigator Dashboard
					</h1>
					<!-- DYNAMIC LOCATION SEARCH - START -->
					<div class="flex items-center space-x-2 bg-forest/50 rounded-lg px-3 py-1">
						<span class="text-sm text-mint">üìç</span>
						<input type="text" id="locationSearchInput" placeholder="Search for a location..." class="bg-transparent text-sm text-white border-none outline-none focus:outline-none w-48">
						<button id="locationSearchBtn" class="bg-emerald/50 hover:bg-emerald/70 rounded px-2 py-0.5 text-xs">Search</button>
					</div>
					<!-- DYNAMIC LOCATION SEARCH - END -->
					<div class="flex items-center space-x-2 bg-forest/50 rounded-lg px-3 py-1">
						<span id="seasonIndicator" class="text-sm">üå± Spring Season</span>
					</div>
				</div>
				<div class="grid grid-cols-3 gap-3 items-center">
					<button class="bg-emerald/20 hover:bg-emerald/30 w-16 h-16 rounded-lg transition-all duration-300 hover:scale-105 ring-1 ring-emerald/30 shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald/40 flex flex-col items-center justify-center text-center">
						<span class="text-lg">üìä</span>
						<span class="text-[10px] font-medium leading-tight">Insights</span>
					</button>
					<button class="bg-sage/20 hover:bg-sage/30 w-16 h-16 rounded-lg transition-all duration-300 hover:scale-105 ring-1 ring-sage/30 shadow-sm focus:outline-none focus:ring-2 focus:ring-sage/40 flex flex-col items-center justify-center text-center">
						<span class="text-lg">üó∫</span>
						<span class="text-[10px] font-medium leading-tight">explore</span>
					</button>
					<button class="bg-mint/20 hover:bg-mint/30 w-16 h-16 rounded-lg transition-all duration-300 hover:scale-105 ring-1 ring-mint/30 shadow-sm focus:outline-none focus:ring-2 focus:ring-mint/40 flex flex-col items-center justify-center text-center">
						<span class="text-lg">üéÆ</span>
						<span class="text-[10px] font-medium leading-tight">Simulator game</span>
					</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard -->
    <main class="container mx-auto px-6 py-8">
        <!-- Card Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
            <!-- Weather Card -->
            <div class="card-hover bg-gradient-to-br from-forest/80 to-deep-green/80 backdrop-blur-lg rounded-2xl p-6 border border-emerald/20 cursor-pointer" onclick="expandCard('weather')">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-emerald">‚òÄ Weather</h3>
                    <div class="pulse-glow bg-emerald/20 rounded-full p-2">
                        <span class="text-2xl">üå§</span>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-300">Temperature</span>
                        <span id="tempValue" class="text-2xl font-bold text-white animate-count">28¬∞C</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span  class="text-gray-300">Rainfall</span>
                        <span id="rainfallValue" class="text-xl font-semibold text-mint animate-count">15mm</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-300">Drought Index</span>
                        <span id="droughtValue" class="text-lg font-medium text-yellow-400 animate-count">Low</span>
                    </div>
                </div>
                <div class="mt-4 bg-emerald/10 rounded-lg p-3">
                    <div class="chart-container">
                        <canvas id="weatherChart"></canvas>
                    </div>
                </div>
                <div class="tooltip absolute bg-black/80 text-white p-2 rounded-lg text-sm">
                    Rainfall from NASA POWER dataset (lat, lon)
                </div>
            </div>

            <!-- Soil Card -->
            <div class="card-hover bg-gradient-to-br from-forest/80 to-deep-green/80 backdrop-blur-lg rounded-2xl p-6 border border-emerald/20 cursor-pointer" onclick="expandCard('soil')">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-emerald">üå± Soil Health</h3>
                    <div class="pulse-glow bg-emerald/20 rounded-full p-2">
                        <span class="text-2xl">üåø</span>
                    </div>
                </div>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-300">Soil Moisture</span>
                            <span id="moistureValue" class="text-lg font-semibold text-mint animate-count">78%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-3">
                            <div id="moistureBar" class="bg-gradient-to-r from-emerald to-mint h-3 rounded-full transition-all duration-2000" style="width: 78%"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <div class="bg-emerald/20 rounded-lg p-2">
                            <div class="text-sm text-gray-300">N</div>
                            <div id="nValue" class="text-lg font-bold text-emerald animate-count">85%</div>
                        </div>
                        <div class="bg-sage/20 rounded-lg p-2">
                            <div class="text-sm text-gray-300">P</div>
                            <div id="pValue" class="text-lg font-bold text-sage animate-count">72%</div>
                        </div>
                        <div class="bg-mint/20 rounded-lg p-2">
                            <div class="text-sm text-gray-300">K</div>
                            <div id="kValue" class="text-lg font-bold text-mint animate-count">91%</div>
                        </div>
                    </div>
                </div>
                <div class="mt-4 bg-emerald/10 rounded-lg p-3">
                    <div class="chart-container">
                        <canvas id="soilChart"></canvas>
                    </div>
                </div>
                <div class="tooltip absolute bg-black/80 text-white p-2 rounded-lg text-sm">
                    Soil moisture from NASA SMAP satellite
                </div>
            </div>

            <!-- Crop/Yield Card -->
            <div class="card-hover bg-gradient-to-br from-forest/80 to-deep-green/80 backdrop-blur-lg rounded-2xl p-6 border border-emerald/20 cursor-pointer" onclick="expandCard('crop')">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-emerald">üåæ Crop Yield</h3>
                    <div class="pulse-glow bg-emerald/20 rounded-full p-2">
                        <span class="text-2xl">üåæ</span>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="text-center">
                        <div id="yieldValue" class="text-3xl font-bold text-emerald animate-count mb-2">4.2t/ha</div>
                        <div class="text-sm text-gray-300">Predicted Yield</div>
                    </div>
                    <div class="flex items-center justify-center space-x-2">
                        <div id="healthIndicator" class="w-4 h-4 bg-emerald rounded-full pulse-glow"></div>
                        <span id="healthStatus" class="text-mint font-medium">Excellent Health</span>
                    </div>
                    <div class="bg-emerald/10 rounded-lg p-3">
                        <div class="text-sm text-gray-300 mb-2">Growth Progress</div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div id="growthBar" class="bg-gradient-to-r from-emerald to-mint h-2 rounded-full transition-all duration-2000" style="width: 85%"></div>
                        </div>
                        <div id="growthText" class="text-right text-xs text-mint mt-1">85% Complete</div>
                    </div>
                </div>
                <div class="mt-4 bg-emerald/10 rounded-lg p-3">
                    <div class="chart-container">
                        <canvas id="cropChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map Widget -->
        <div class="bg-gradient-to-br from-forest/80 to-deep-green/80 backdrop-blur-lg rounded-2xl p-6 border border-emerald/20 mb-8">
            <h3 class="text-xl font-semibold text-emerald mb-4">üó∫ Farm Location</h3>
            <div id="map" class="h-64 rounded-lg"></div>
        </div>

        <!-- Sustainability Score & Quick Actions -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
			<div class="bg-gradient-to-br from-forest/80 to-deep-green/80 backdrop-blur-lg rounded-2xl p-6 border border-emerald/20">
				<h3 class="text-xl font-semibold text-emerald mb-4">üåç Sustainability Score</h3>
				<div class="flex items-center justify-center">
					<div class="relative w-40 h-40">
						<canvas id="sustainabilityGauge" width="160" height="160"></canvas>
						<div class="absolute inset-0 flex items-center justify-center">
							<div id="sustainabilityScoreText" class="text-4xl font-extrabold text-emerald">92</div>
						</div>
					</div>
				</div>
				<div class="mt-4 grid grid-cols-3 gap-2">
					<div class="bg-emerald/15 rounded-lg px-3 py-2 text-center">
						<div class="text-xs text-gray-300">Water Use</div>
						<div class="text-sm font-semibold text-mint">Efficient</div>
					</div>
					<div class="bg-sage/15 rounded-lg px-3 py-2 text-center">
						<div class="text-xs text-gray-300">Carbon</div>
						<div class="text-sm font-semibold text-sage">Low</div>
					</div>
					<div class="bg-mint/15 rounded-lg px-3 py-2 text-center">
						<div class="text-xs text-gray-300">Soil Health</div>
						<div class="text-sm font-semibold text-mint">Strong</div>
					</div>
				</div>
				<div class="mt-4 grid grid-cols-3 gap-3">
					<button class="bg-emerald/20 hover:bg-emerald/30 rounded-lg px-2 py-2 text-center transition-all duration-300 hover:scale-105 ring-1 ring-emerald/30 focus:outline-none focus:ring-2 focus:ring-emerald/40" data-action="offset" data-delta="5">
						<div class="text-xl mb-1">üå≥</div>
						<div class="text-xs">Offset Carbon</div>
					</button>
					<button class="bg-sage/20 hover:bg-sage/30 rounded-lg px-2 py-2 text-center transition-all duration-300 hover:scale-105 ring-1 ring-sage/30 focus:outline-none focus:ring-2 focus:ring-sage/40" data-action="irrigation" data-delta="3">
						<div class="text-xl mb-1">üíß</div>
						<div class="text-xs">Optimize Irrigation</div>
					</button>
					<button class="bg-mint/20 hover:bg-mint/30 rounded-lg px-2 py-2 text-center transition-all duration-300 hover:scale-105 ring-1 ring-mint/30 focus:outline-none focus:ring-2 focus:ring-mint/40" data-action="waste" data-delta="2">
						<div class="text-xl mb-1">‚ôªÔ∏è</div>
						<div class="text-xs">Reduce Waste</div>
					</button>
				</div>
			</div>

            <div class="bg-gradient-to-br from-forest/80 to-deep-green/80 backdrop-blur-lg rounded-2xl p-6 border border-emerald/20 relative overflow-hidden">
                <!-- Subtle background elements -->
                <div class="absolute top-0 left-0 w-full h-full opacity-5">
                    <div class="absolute top-4 left-4 w-1 h-1 bg-white rounded-full animate-ping"></div>
                    <div class="absolute top-8 right-8 w-0.5 h-0.5 bg-white rounded-full animate-pulse"></div>
                    <div class="absolute bottom-12 left-12 w-1 h-1 bg-white rounded-full animate-bounce"></div>
                    <div class="absolute bottom-6 right-6 w-0.5 h-0.5 bg-white rounded-full animate-ping"></div>
                </div>
                
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold text-white">
                            üõ∞Ô∏è Did you know?
                        </h3>
                        <div class="flex items-center space-x-1">
                            <div class="w-1 h-1 bg-white rounded-full animate-pulse"></div>
                            <div class="w-1 h-1 bg-white rounded-full animate-pulse" style="animation-delay: 0.5s;"></div>
                            <div class="w-1 h-1 bg-white rounded-full animate-pulse" style="animation-delay: 1s;"></div>
                        </div>
                    </div>
                    
                    <div class="fact-carousel-container">
                        <div class="fact-carousel" id="factCarousel">
                            <div class="fact-slide active">
                                <div class="fact-icon">üå±</div>
                                <div class="fact-text">NASA satellites track soil moisture from space ‚Äî this helps farmers know when and how much to irrigate, reducing water waste by up to 30%.</div>
                            </div>
                            <div class="fact-slide">
                                <div class="fact-icon">üåç</div>
                                <div class="fact-text">Carbon monitoring from space helps measure emissions from farming and land use ‚Äî vital for understanding agriculture's role in climate change.</div>
                            </div>
                            <div class="fact-slide">
                                <div class="fact-icon">üåæ</div>
                                <div class="fact-text">Normalized Difference Vegetation Index (NDVI) from NASA satellite data can show crop health before it's visible to the human eye.</div>
                            </div>
                            <div class="fact-slide">
                                <div class="fact-icon">‚òÄÔ∏è</div>
                                <div class="fact-text">Temperature anomalies mapped by satellites help predict crop stress during heatwaves, giving farmers time to adapt.</div>
                            </div>
                            <div class="fact-slide">
                                <div class="fact-icon">üíß</div>
                                <div class="fact-text">Evapotranspiration data from satellites estimate how much water crops are losing to the atmosphere, guiding efficient irrigation.</div>
                            </div>
                            <div class="fact-slide">
                                <div class="fact-icon">üõ∞Ô∏è</div>
                                <div class="fact-text">SMAP (Soil Moisture Active Passive) satellite measures soil moisture globally, helping predict droughts and optimize planting schedules.</div>
                            </div>
                            <div class="fact-slide">
                                <div class="fact-icon">üå≥</div>
                                <div class="fact-text">Sustainable farming practices like cover cropping and reduced tillage can increase soil carbon storage, which satellites can monitor over time.</div>
                            </div>
                        </div>
                        <div class="carousel-indicators">
                            <span class="indicator active" data-slide="0"></span>
                            <span class="indicator" data-slide="1"></span>
                            <span class="indicator" data-slide="2"></span>
                            <span class="indicator" data-slide="3"></span>
                            <span class="indicator" data-slide="4"></span>
                            <span class="indicator" data-slide="5"></span>
                            <span class="indicator" data-slide="6"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

		<!-- Immersive Horizontal Scroll Video Gallery -->
		<section id="scrollGallery" class="container mx-auto px-6 mt-14 mb-16">
			<div class="hscroll-outer">
				<div class="hscroll-sticky">
					<div class="hscroll-track">
						<!-- Video Cards: replace src with your own files in assets/videos -->
						<figure class="hvideo">
							<video class="hvideo-el" src="assets/videos/backgroundd.mp4" muted loop playsinline preload="metadata"></video>
							<figcaption>Earth Systems</figcaption>
						</figure>
						<figure class="hvideo">
							<video class="hvideo-el" src="assets/videos/video1.mp4" muted loop playsinline preload="metadata"></video>
							<figcaption>Crop Canopy</figcaption>
						</figure>
						<figure class="hvideo">
							<video class="hvideo-el" src="assets/videos/video2.mp4" muted loop playsinline preload="metadata"></video>
							<figcaption>Water Cycle</figcaption>
						</figure>
						<figure class="hvideo">
							<video class="hvideo-el" src="assets/videos/video3.mp4" muted loop playsinline preload="metadata"></video>
							<figcaption>Soil Moisture</figcaption>
						</figure>
						<figure class="hvideo">
							<video class="hvideo-el" src="assets/videos/video4.mp4" muted loop playsinline preload="metadata"></video>
							<figcaption>Thermal Bands</figcaption>
						</figure>
					</div>
				</div>
			</div>
		</section>
    </main>

    <!-- Footer: End-of-page section -->
    <footer class="mt-12 bg-[#0b1a16] border-t border-emerald/20">
        <div class="container mx-auto px-6 py-10">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h4 class="orbitron text-white font-extrabold tracking-wide mb-3">Farm Navigator</h4>
                    <p class="text-sm text-gray-300/80 leading-relaxed">Data-driven insights for sustainable agriculture using a modern, immersive dashboard.</p>
                </div>
                <div>
                    <h5 class="text-emerald font-semibold mb-2">Resources</h5>
                    <ul class="space-y-1 text-sm text-gray-300/80">
                        <li><a href="#" class="hover:text-white transition">Docs</a></li>
                        <li><a href="#" class="hover:text-white transition">API</a></li>
                        <li><a href="#" class="hover:text-white transition">Changelog</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="text-emerald font-semibold mb-2">Explore</h5>
                    <ul class="space-y-1 text-sm text-gray-300/80">
                        <li><a href="#" class="hover:text-white transition">Weather</a></li>
                        <li><a href="#" class="hover:text-white transition">Soil</a></li>
                        <li><a href="#" class="hover:text-white transition">Yield</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="text-emerald font-semibold mb-3">Stay Connected</h5>
                    <div class="flex items-center gap-3">
                        <a class="ring-1 ring-white/15 bg-white/5 hover:bg-white/10 transition rounded-full px-3 py-1 text-sm" href="#">Twitter</a>
                        <a class="ring-1 ring-white/15 bg-white/5 hover:bg-white/10 transition rounded-full px-3 py-1 text-sm" href="#">GitHub</a>
                        <a class="ring-1 ring-white/15 bg-white/5 hover:bg-white/10 transition rounded-full px-3 py-1 text-sm" href="#">YouTube</a>
                    </div>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-white/10 flex items-center justify-between text-xs text-gray-400">
                <span>¬© <span id="yearSpan"></span> Farm Navigator. All rights reserved.</span>
                <div class="flex gap-4">
                    <a href="#" class="hover:text-white transition">Privacy</a>
                    <a href="#" class="hover:text-white transition">Terms</a>
                    <a href="#" class="hover:text-white transition">Contact</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Backend Api is
const API_BASE_URL = 'http://127.0.0.1:8000';
let weatherChart, soilChart, cropChart;
        // Initialize charts and animations
// Initialize everything when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            initializeMap();
            setupLocationSearch();
            initializeSustainabilityGauge();
            initializeHorizontalGallery();
            initializeFactCarousel();
            const y = document.getElementById('yearSpan'); if (y) y.textContent = new Date().getFullYear();
        });
// --- NEW: Central function to update all dashboard data ---
        async function updateDashboardData(lat, lon) {
            console.log(`Fetching data for: ${lat}, ${lon}`);
            const cards = document.querySelectorAll('.card-hover');
            cards.forEach(card => card.style.opacity = '0.5'); // Dim cards while loading

            try {
                // Fetch all data in parallel for speed
                const [weatherRes, soilRes, cropRes] = await Promise.all([
                    fetch(`${API_BASE_URL}/climate-data?lat=${lat}&lon=${lon}`),
                    fetch(`${API_BASE_URL}/soil-status?lat=${lat}&lon=${lon}`),
                    fetch(`${API_BASE_URL}/crop-health?lat=${lat}&lon=${lon}&crop=maize`)
                ]);

                if (!weatherRes.ok || !soilRes.ok || !cropRes.ok) {
                    throw new Error('One or more API calls failed');
                }

                const weatherData = await weatherRes.json();
                const soilData = await soilRes.json();
                const cropData = await cropRes.json();

                // Update UI with new data
                updateWeatherCard(weatherData);
                updateSoilCard(soilData);
                updateCropCard(cropData);

            } catch (error) {
                console.error("Failed to update dashboard:", error);
                alert("Could not fetch data for the selected location. Please check the backend server and try again.");
            } finally {
                cards.forEach(card => card.style.opacity = '1'); // Restore card opacity
            }
        }

// --- NEW: Functions to update each card ---
        function updateWeatherCard(data) {
            document.getElementById('tempValue').textContent = `${data.temperature.toFixed(1)}¬∞C`;
            document.getElementById('rainfallValue').textContent = `${data.rainfall.toFixed(1)}mm`;
            document.getElementById('droughtValue').textContent = data.drought_index > 0.7 ? 'High' : (data.drought_index > 0.4 ? 'Medium' : 'Low');
            
            weatherChart.data.labels = data.history.map(h => new Date(h.day).toLocaleDateString('en-US', { weekday: 'short' }));
            weatherChart.data.datasets[0].data = data.history.map(h => h.temperature); // Assuming temp history is available
            weatherChart.data.datasets[1].data = data.history.map(h => h.rainfall);
            weatherChart.update();
        }

        function updateSoilCard(data) {
            document.getElementById('moistureValue').textContent = `${data.moisture.toFixed(1)}%`;
            document.getElementById('moistureBar').style.width = `${data.moisture}%`;
            document.getElementById('nValue').textContent = `${data.nutrients.N}%`;
            document.getElementById('pValue').textContent = `${data.nutrients.P}%`;
            document.getElementById('kValue').textContent = `${data.nutrients.K}%`;

            soilChart.data.datasets[0].data = [data.nutrients.N, data.nutrients.P, data.nutrients.K];
            soilChart.update();
        }

        function updateCropCard(data) {
            document.getElementById('yieldValue').textContent = `${data.predicted_yield.toFixed(1)}t/ha`;
            document.getElementById('healthStatus').textContent = data.status.charAt(0).toUpperCase() + data.status.slice(1);
            const healthIndicator = document.getElementById('healthIndicator');
            if (data.status === 'thriving') healthIndicator.className = 'w-4 h-4 bg-emerald rounded-full pulse-glow';
            else if (data.status === 'healthy') healthIndicator.className = 'w-4 h-4 bg-yellow-400 rounded-full pulse-glow';
            else healthIndicator.className = 'w-4 h-4 bg-red-500 rounded-full pulse-glow';
            
            document.getElementById('growthBar').style.width = `${data.health_score}%`;
            document.getElementById('growthText').textContent = `${data.health_score}% Complete`;

            cropChart.data.datasets[0].data = data.trend;
            cropChart.update();
        }        

// Chart initialization
function initializeCharts() {
    // Weather Chart
    const weatherCtx = document.getElementById('weatherChart').getContext('2d');
    weatherChart = new Chart(weatherCtx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Temperature (¬∞C)',
                data: [25, 28, 26, 30, 28, 27, 29],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'Rainfall (mm)',
                data: [5, 15, 8, 0, 12, 20, 3],
                borderColor: '#6ee7b7',
                backgroundColor: 'rgba(110, 231, 183, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: '#ffffff'
                    }
                }
            },
            scales: {
                x: {
                    ticks: { color: '#ffffff' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                },
                y: {
                    ticks: { color: '#ffffff' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                }
            }
        }
    });

    // Soil Chart
    const soilCtx = document.getElementById('soilChart').getContext('2d');
    soilChart =new Chart(soilCtx, {
        type: 'doughnut',
        data: {
            labels: ['Nitrogen', 'Phosphorus', 'Potassium'],
            datasets: [{
                data: [85, 72, 91],
                backgroundColor: ['#10b981', '#34d399', '#6ee7b7'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#ffffff',
                        padding: 10
                    }
                }
            }
        }
    });

    // Crop Chart
    const cropCtx = document.getElementById('cropChart').getContext('2d');
    cropChart = new Chart(cropCtx, {
        type: 'bar',
        data: {
            labels: ['Week 1', 'Week 2', 'Week 3'],
            datasets: [{
                label: 'Yield Forecast (t/ha)',
                data: [3.2, 3.8, 4.1],
                backgroundColor: 'rgba(16, 185, 129, 0.8)',
                borderColor: '#10b981',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: '#ffffff'
                    }
                }
            },
            scales: {
                x: {
                    ticks: { color: '#ffffff' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                },
                y: {
                    ticks: { color: '#ffffff' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                }
            }
        }
    });
}

// Map initialization
let appMap;
let currentMarker;
let farmIcon;

function initializeMap() {
    appMap = L.map('map').setView([40.7128, -74.0060], 10);
    
    // Add tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
    }).addTo(appMap);
    
    // Add farm marker
    farmIcon = L.divIcon({
        html: 'üåæ',
        iconSize: [30, 30],
        className: 'farm-marker'
    });
    
    currentMarker = L.marker([40.7128, -74.0060], { icon: farmIcon })
        .addTo(appMap)
        .bindPopup('üåæ Your Farm Location<br>Coordinates: 40.7128, -74.0060');
    
    // Add NASA overlay simulation
    const overlayBounds = [[40.6, -74.2], [40.8, -73.8]];
    L.rectangle(overlayBounds, {
        color: '#10b981',
        weight: 2,
        opacity: 0.6,
        fillOpacity: 0.2
    }).addTo(appMap).bindPopup('NASA Satellite Coverage Area');
}

function updateMapLocation(lat, lon, label) {
    if (!appMap) return;
    appMap.setView([lat, lon], 11);
    if (currentMarker) {
        currentMarker.setLatLng([lat, lon]).setPopupContent(`üåæ ${label}<br>Coordinates: ${lat.toFixed(4)}, ${lon.toFixed(4)}`);
    } else {
        currentMarker = L.marker([lat, lon], { icon: farmIcon }).addTo(appMap).bindPopup(`üåæ ${label}<br>Coordinates: ${lat.toFixed(4)}, ${lon.toFixed(4)}`);
    }
}

// --- MODIFIED: Setup location search input and button ---
        function setupLocationSearch() {
            const searchBtn = document.getElementById('locationSearchBtn');
            const searchInput = document.getElementById('locationSearchInput');

            searchBtn.addEventListener('click', searchLocation);
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    searchLocation();
                }
            });
            
            // Try geolocating on load for a good default
            geolocateAndUpdate();
        }

        // --- NEW: Function to handle location search ---
        async function searchLocation() {
            const input = document.getElementById('locationSearchInput');
            const query = input.value.trim();
            if (!query) return;

            // Use OpenStreetMap's free Nominatim API for geocoding
            const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=1`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data && data.length > 0) {
                    const { lat, lon, display_name } = data[0];
                    const latitude = parseFloat(lat);
                    const longitude = parseFloat(lon);
                    
                    updateMapLocation(latitude, longitude, display_name);
                    updateDashboardData(latitude, longitude); // <-- UPDATE ALL DATA
                } else {
                    alert('Location not found. Please try a different search term.');
                }
            } catch (error) {
                console.error('Geocoding API error:', error);
                alert('Could not search for location. Please check your connection.');
            }
        }
        
        function geolocateAndUpdate() {
            if (!navigator.geolocation) {
                // Default to a known location if no geolocation
                updateMapLocation(23.0225, 72.5714, 'Ahmedabad, Gujarat, India');
                updateDashboardData(23.0225, 72.5714);
                return;
            }
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    const { latitude, longitude } = pos.coords;
                    updateMapLocation(latitude, longitude, 'Your Current Location');
                    updateDashboardData(latitude, longitude);
                },
                () => {
                    // Fallback to default on error
                    updateMapLocation(23.0225, 72.5714, 'Ahmedabad, Gujarat, India');
                    updateDashboardData(23.0225, 72.5714);
                },
                { enableHighAccuracy: true, timeout: 8000, maximumAge: 60000 }
            );
        }

// Animation initialization
function initializeAnimations() {
    // Animate numbers on scroll
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                animateValue(entry.target);
            }
        });
    });

    document.querySelectorAll('.animate-count').forEach(el => {
        observer.observe(el);
    });

    // Stagger card animations
    const cards = document.querySelectorAll('.card-hover');
    cards.forEach((card, index) => {
        card.style.animationDelay = '${index * 0.2}s';
        card.classList.add('animate-fade-in');
    });
}

// Animate number counting
function animateValue(element) {
    const text = element.textContent;
    const number = parseFloat(text.match(/[\d.]+/)?.[0] || 0);
    const unit = text.replace(/[\d.]+/, '');
    
    if (number > 0) {
        let current = 0;
        const increment = number / 50;
        const timer = setInterval(() => {
            current += increment;
            if (current >= number) {
                current = number;
                clearInterval(timer);
            }
            element.textContent = current.toFixed(number % 1 === 0 ? 0 : 1) + unit;
        }, 40);
    }
}

// Card expansion functionality
function expandCard(cardType) {
    const card = event.currentTarget;
    
    // Add expansion animation
    card.style.transform = 'scale(1.05)';
    card.style.zIndex = '10';
    
    // Reset after animation
    setTimeout(() => {
        card.style.transform = '';
        card.style.zIndex = '';
    }, 300);
    
    // Show detailed view based on card type
    switch(cardType) {
        case 'weather':
            showWeatherDetails();
            break;
        case 'soil':
            showSoilDetails();
            break;
        case 'crop':
            showCropDetails();
            break;
    }
}

// Detailed view functions
function showWeatherDetails() {
    alert('üå§ 7-Day Weather Forecast\n\nDetailed weather trends and predictions would be displayed here with interactive charts showing temperature, rainfall, humidity, and wind patterns.');
}

function showSoilDetails() {
    alert('üå± Soil Analysis Details\n\nDetailed soil composition analysis would be displayed here, including moisture levels at different depths (10cm vs 1m) and nutrient distribution maps.');
}

function showCropDetails() {
    alert('üåæ Crop Management Simulator\n\nInteractive "What if?" simulator would be displayed here, allowing you to toggle irrigation, fertilization, and other factors to see instant yield predictions.');
}

// Tooltip setup
function setupTooltips() {
    const cards = document.querySelectorAll('.card-hover');
    
    cards.forEach(card => {
        const tooltip = card.querySelector('.tooltip');
        if (tooltip) {
            card.addEventListener('mouseenter', () => {
                tooltip.classList.add('show');
            });
            
            card.addEventListener('mouseleave', () => {
                tooltip.classList.remove('show');
            });
        }
    });
}

// Smooth scroll for navigation
function smoothScroll(target) {
    document.querySelector(target).scrollIntoView({
        behavior: 'smooth'
    });
}

// Add fade-in animation CSS
const style = document.createElement('style');
style.textContent = `
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .animate-fade-in {
        animation: fadeIn 0.8s ease-out forwards;
    }
    
    .farm-marker {
        background: none;
        border: none;
        font-size: 24px;
    }
`;
document.head.appendChild(style);

// Add interactive features
document.addEventListener('click', function(e) {
    // Quick action buttons
    if (e.target.closest('button')) {
        const button = e.target.closest('button');
        const text = button.textContent.trim();
        
        if (text.includes('Irrigate')) {
            showIrrigationDialog();
        } else if (text.includes('Fertilize')) {
            showFertilizationDialog();
        } else if (text.includes('Harvest')) {
            showHarvestDialog();
        }
    }
});

function showIrrigationDialog() {
    alert('üö∞ Irrigation System\n\nOptimal irrigation schedule calculated based on:\n‚Ä¢ Current soil moisture: 78%\n‚Ä¢ Weather forecast: Light rain expected\n‚Ä¢ Crop water requirements: Moderate\n\nRecommendation: Delay irrigation for 2 days');
}

function showFertilizationDialog() {
    alert('üå± Fertilization Planner\n\nNutrient analysis shows:\n‚Ä¢ Nitrogen: 85% (Good)\n‚Ä¢ Phosphorus: 72% (Moderate)\n‚Ä¢ Potassium: 91% (Excellent)\n\nRecommendation: Apply phosphorus-rich fertilizer in 1 week');
}

function showHarvestDialog() {
    alert('üåæ Harvest Optimizer\n\nCrop maturity analysis:\n‚Ä¢ Growth progress: 85%\n‚Ä¢ Estimated harvest date: 15 days\n‚Ä¢ Expected yield: 4.2 t/ha\n‚Ä¢ Quality grade: Premium\n\nOptimal harvest window: March 15-20');
}

// Sustainability Gauge
let sustainabilityScore = 92;
let sustainabilityGaugeCtx;

function initializeSustainabilityGauge() {
    const canvas = document.getElementById('sustainabilityGauge');
    if (!canvas) return;
    sustainabilityGaugeCtx = canvas.getContext('2d');
    drawSustainabilityGauge(sustainabilityScore);
    // Hook up interactive buttons
    document.querySelectorAll('[data-action][data-delta]').forEach(btn => {
        btn.addEventListener('click', () => {
            const delta = parseInt(btn.getAttribute('data-delta')) || 0;
            adjustSustainabilityScore(delta);
        });
    });
}

function adjustSustainabilityScore(delta) {
    sustainabilityScore = Math.max(0, Math.min(100, sustainabilityScore + delta));
    drawSustainabilityGauge(sustainabilityScore, true);
    const textEl = document.getElementById('sustainabilityScoreText');
    if (textEl) textEl.textContent = sustainabilityScore.toString();
}

function drawSustainabilityGauge(score, animate = false) {
    if (!sustainabilityGaugeCtx) return;
    const ctx = sustainabilityGaugeCtx;
    const { width, height } = ctx.canvas;
    const centerX = width / 2;
    const centerY = height / 2;
    const radius = Math.min(width, height) / 2 - 8;
    const startAngle = Math.PI * 0.75; // 135deg
    const endAngle = Math.PI * 2.25; // 405deg
    const targetAngle = startAngle + (endAngle - startAngle) * (score / 100);

    let current = animate ? 0 : score;
    const steps = animate ? 30 : 1;
    const increment = (score - current) / steps;

    function renderFrame() {
        ctx.clearRect(0, 0, width, height);

        // Track background
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.strokeStyle = 'rgba(255,255,255,0.15)';
        ctx.lineWidth = 12;
        ctx.lineCap = 'round';
        ctx.stroke();

        // Gradient arc
        const gradient = ctx.createLinearGradient(0, 0, width, 0);
        gradient.addColorStop(0, '#10b981');
        gradient.addColorStop(0.6, '#34d399');
        gradient.addColorStop(1, '#6ee7b7');

        const currentAngle = startAngle + (endAngle - startAngle) * (current / 100);
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, currentAngle);
        ctx.strokeStyle = gradient;
        ctx.lineWidth = 12;
        ctx.lineCap = 'round';
        ctx.stroke();

        // Tick marks
        for (let i = 0; i <= 10; i++) {
            const t = i / 10;
            const angle = startAngle + (endAngle - startAngle) * t;
            const inner = radius - 14;
            const outer = radius + 2;
            ctx.beginPath();
            ctx.moveTo(centerX + inner * Math.cos(angle), centerY + inner * Math.sin(angle));
            ctx.lineTo(centerX + outer * Math.cos(angle), centerY + outer * Math.sin(angle));
            ctx.strokeStyle = 'rgba(255,255,255,0.25)';
            ctx.lineWidth = i % 5 === 0 ? 2 : 1;
            ctx.stroke();
        }

        if (animate && Math.abs(current - score) > 0.01) {
            current += increment;
            requestAnimationFrame(renderFrame);
        }
    }

    renderFrame();
}

// Horizontal scroll video gallery logic
function initializeHorizontalGallery() {
    const outer = document.querySelector('#scrollGallery .hscroll-outer');
    const track = document.querySelector('#scrollGallery .hscroll-track');
    if (!outer || !track) return;

    // Calculate total scroll width
    const cards = Array.from(track.children);
    const totalWidth = cards.reduce((sum, el) => sum + el.getBoundingClientRect().width, 0) + (cards.length - 1) * 24 + 48;
    const viewport = outer.getBoundingClientRect().width;
    const maxTranslate = Math.max(0, totalWidth - viewport);

    const sticky = document.querySelector('#scrollGallery .hscroll-sticky');
    const start = outer.offsetTop;
    const duration = outer.offsetHeight - sticky.offsetHeight;

    function onScroll() {
        const scrollY = window.scrollY || window.pageYOffset;
        const progress = Math.min(1, Math.max(0, (scrollY - start) / duration));
        const translateX = -maxTranslate * progress;
        track.style.transform = `translate3d(${translateX}px, 0, 0)`;

        // Auto-play/pause videos based on visibility
        cards.forEach(card => {
            const video = card.querySelector('video');
            if (!video) return;
            const rect = card.getBoundingClientRect();
            const visible = rect.right > 80 && rect.left < (window.innerWidth - 80);
            if (visible) {
                video.play().catch(() => {});
            } else {
                video.pause();
            }
        });
    }

    // Hover autoplay
    track.querySelectorAll('video').forEach(v => {
        v.addEventListener('mouseenter', () => v.play().catch(() => {}));
        v.addEventListener('mouseleave', () => v.pause());
    });

    onScroll();
    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', () => setTimeout(initializeHorizontalGallery, 50), { once: true });
}

// Hide header on scroll down, show on scroll up
(function hideHeaderOnScroll(){
    const header = document.getElementById('mainHeader');
    if (!header) return;
    let lastY = window.scrollY || 0;
    function onScroll(){
        const y = window.scrollY || 0;
        const goingDown = y > lastY && y > 40; // ignore tiny movements
        header.style.transition = 'transform 0.35s ease, opacity 0.25s ease';
        if (goingDown) {
            header.style.transform = 'translateY(-100%)';
            header.style.opacity = '0';
        } else {
            header.style.transform = 'translateY(0)';
            header.style.opacity = '1';
        }
        lastY = y;
    }
    window.addEventListener('scroll', onScroll, { passive: true });
})();

// Fact Carousel functionality
let currentFactIndex = 0;
let factCarouselInterval;
const factSlides = document.querySelectorAll('.fact-slide');
const indicators = document.querySelectorAll('.indicator');

function initializeFactCarousel() {
    if (!document.getElementById('factCarousel')) return;
    
    // Set up indicator click handlers
    indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => {
            goToFact(index);
        });
    });
    
    // Start auto-rotation
    startFactRotation();
    
    // Pause on hover
    const carouselContainer = document.querySelector('.fact-carousel-container');
    if (carouselContainer) {
        carouselContainer.addEventListener('mouseenter', pauseFactRotation);
        carouselContainer.addEventListener('mouseleave', startFactRotation);
    }
}

function startFactRotation() {
    if (factCarouselInterval) clearInterval(factCarouselInterval);
    factCarouselInterval = setInterval(() => {
        nextFact();
    }, 6000); // Change every 6 seconds
}

function pauseFactRotation() {
    if (factCarouselInterval) {
        clearInterval(factCarouselInterval);
        factCarouselInterval = null;
    }
}

function nextFact() {
    const nextIndex = (currentFactIndex + 1) % factSlides.length;
    goToFact(nextIndex);
}

function goToFact(index) {
    if (index === currentFactIndex) return;
    
    // Add special effect for manual navigation
    const container = document.querySelector('.fact-carousel-container');
    if (container) {
        container.style.transform = 'scale(0.98)';
        setTimeout(() => {
            container.style.transform = 'scale(1)';
        }, 150);
    }
    
    // Remove active classes
    factSlides[currentFactIndex].classList.remove('active');
    indicators[currentFactIndex].classList.remove('active');
    
    // Add prev class to current slide for smooth transition
    factSlides[currentFactIndex].classList.add('prev');
    
    // Update current index
    currentFactIndex = index;
    
    // Add active classes with enhanced animation
    factSlides[currentFactIndex].classList.add('active');
    indicators[currentFactIndex].classList.add('active');
    
    // Add sparkle effect
    createSparkleEffect();
    
    // Remove prev class after transition
    setTimeout(() => {
        factSlides.forEach(slide => slide.classList.remove('prev'));
    }, 1200);
}

function createSparkleEffect() {
    const container = document.querySelector('.fact-carousel-container');
    if (!container) return;
    
    for (let i = 0; i < 4; i++) {
        const sparkle = document.createElement('div');
        sparkle.style.cssText = `
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 20;
            left: ${Math.random() * 100}%;
            top: ${Math.random() * 100}%;
            animation: sparkleEffect 1.2s ease-out forwards;
        `;
        
        container.appendChild(sparkle);
        
        setTimeout(() => {
            if (sparkle.parentNode) {
                sparkle.parentNode.removeChild(sparkle);
            }
        }, 1200);
    }
}

// Add sparkle animation CSS
const sparkleStyle = document.createElement('style');
sparkleStyle.textContent = `
    @keyframes sparkleEffect {
        0% {
            opacity: 0;
            transform: scale(0);
        }
        50% {
            opacity: 1;
            transform: scale(1.2);
        }
        100% {
            opacity: 0;
            transform: scale(0.8);
        }
    }
`;
document.head.appendChild(sparkleStyle);
    </script>
</body>
</html>